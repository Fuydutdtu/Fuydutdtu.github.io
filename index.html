<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lsplash Live Tracker</title>
  <style>
    body {
      background-color: #2f3136;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .tracker-container {
      max-width: 750px;
      margin: 0 auto;
      background: #36393f;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      flex: 1;
    }
    .tracker-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .tracker-header img {
      border-radius: 50%;
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .tracker-title {
      font-size: 32px;
      color: #00FF00;
    }
    .section {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #2c2f33;
    }
    .section-title {
      font-size: 24px;
      margin-bottom: 10px;
      color: #00FF00;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .field {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .field span.label {
      display: inline-block;
      width: 210px;
      font-weight: bold;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background: #36393f;
      border-radius: 8px;
      font-size: 14px;
      color: #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    footer img {
      border-radius: 50%;
      width: 30px;
      height: 30px;
    }
  </style>
</head>
<body>
  <div class="tracker-container">
    <div class="tracker-header">
      <!-- Replace with your image -->
      <img src="images/splash.jpg" alt="Lsplash">
      <div class="tracker-title">Lsplash Live Tracker</div>
    </div>
    <div class="section" id="systemData">
      <div class="section-title">üñ•Ô∏è System Data</div>
      <div class="field" id="ipField"></div>
      <div class="field" id="locationField"></div>
      <div class="field" id="deviceField"></div>
      <div class="field" id="appsField"></div>
      <div class="field" id="cpuField"></div>
      <div class="field" id="uptimeField"></div>
      <div class="field" id="networkField"></div>
      <div class="field" id="headphoneField"></div>
      <div class="field" id="usageModeField"></div>
    </div>
    <div class="section" id="personalData">
      <div class="section-title">üíì Personal Data</div>
      <div class="field" id="heartField"></div>
      <div class="field" id="tempField"></div>
      <div class="field" id="energyField"></div>
      <div class="field" id="sleepField"></div>
      <div class="field" id="lastSeenField"></div>
      <div class="field" id="activityField"></div>
      <div class="field" id="keysField"></div>
      <div class="field" id="phoneField"></div>
    </div>
    <div class="section" id="mentalState">
      <div class="section-title">üß† Mental State</div>
      <div class="field" id="stressField"></div>
      <div class="field" id="thoughtField"></div>
      <!-- EST Time updates every second -->
      <div class="field" id="timeField"></div>
    </div>
  </div>

  <!-- Footer Section -->
  <footer>
    <img src="images/pfp.jpg" alt="Profile Picture">
    <div>
      <strong>Made By RobloxEmployee</strong><br>
      Dont Worry, We See You Too üëÄ
    </div>
  </footer>

  <script>
    /* ---------------- Utility Functions ---------------- */
    function getTimeInMinutes() {
      // Get time in minutes since midnight in EST
      let now = new Date();
      // Adjust for EST (UTC-5) if necessary:
      let utc = now.getTime() + now.getTimezoneOffset() * 60000;
      let est = new Date(utc - 5 * 3600000);
      return est.getHours() * 60 + est.getMinutes() + est.getSeconds()/60;
    }
    function pad(n) { return n < 10 ? "0" + n : n; }
    function getESTTimeString() {
      let now = new Date();
      let utc = now.getTime() + now.getTimezoneOffset() * 60000;
      let est = new Date(utc - 5 * 3600000);
      let hours = est.getHours();
      let minutes = est.getMinutes();
      let ampm = hours >= 12 ? "PM" : "AM";
      hours = hours % 12;
      hours = hours ? hours : 12;
      return `${hours}:${pad(minutes)} ${ampm}`;
    }

    /* ---------------- Persistent State Setup ---------------- */
    // Define location mapping with descriptions and preset travel durations (in ms)
    const locationMapping = {
      "4184 Berkshire Circle, Chattanooga, TN": { description: "His House", travelTime: 0 },
      "The Fresh Market, 2288 Gunbarrel Rd #124, Chattanooga, TN 37421": { description: "Grocery Store", travelTime: 10 * 60 * 1000 },
      "1701 Skyline Dr, Chattanooga, TN 37421": { description: "Redibles House", travelTime: 10 * 60 * 1000 },
      "12033 Haycutter Rd, Birchwood, TN": { description: "Jasper's House", travelTime: 54 * 60 * 1000 }
    };
    // Use the keys as addresses
    const addresses = Object.keys(locationMapping);

    // We decide the work location for the day (deterministically based on day of month)
    function getWorkLocation() {
      const d = new Date().getDate();
      if (d % 3 === 1) return "4184 Berkshire Circle, Chattanooga, TN"; // work at home
      else if (d % 3 === 2) return "1701 Skyline Dr, Chattanooga, TN 37421"; // Redibles House
      else return "12033 Haycutter Rd, Birchwood, TN"; // Jasper's House
    }

    // Initial simulation state ‚Äì note we include a workLocation.
    function getInitialState() {
      return {
        current_ip: "192.241.0.1",
        ip_set_time: Date.now(),
        // Start at home:
        current_location: "4184 Berkshire Circle, Chattanooga, TN",
        target_location: "4184 Berkshire Circle, Chattanooga, TN",
        isTraveling: false,
        travelStartTime: null,
        travelDuration: 0,
        workLocation: getWorkLocation(),
        device_info: "Windows 11 | Ryzen 7 5800X | RTX 3070",
        energyLevel: 80,  // percentage
        phone_battery: 80, // percentage
        phoneCharging: false,
        current_activity: "",
        activity_start_time: Date.now(),
        activity_duration: 0,
        persistentHeartRate: 75,
        persistentBodyTemp: 36.8, // in ¬∞C (about 98.2¬∞F)
        uptimeStart: Date.now()
      };
    }
    function loadState() {
      let stateStr = localStorage.getItem("simulationState");
      return stateStr ? JSON.parse(stateStr) : getInitialState();
    }
    function saveState(state) {
      localStorage.setItem("simulationState", JSON.stringify(state));
    }
    let simulationState = loadState();

    /* ---------------- Leader Election Setup ---------------- */
    const LEADER_TIMEOUT = 2000; // 2 seconds
    const myTabId = Date.now() + "-" + Math.random();
    function isLeader() {
      return localStorage.getItem("simulationLeader") === myTabId;
    }
    function updateLeaderHeartbeat() {
      if (isLeader()) {
        localStorage.setItem("simulationLeaderTimestamp", Date.now().toString());
      }
    }
    function tryToBecomeLeader() {
      let currentLeader = localStorage.getItem("simulationLeader");
      let leaderTimestamp = parseInt(localStorage.getItem("simulationLeaderTimestamp") || "0", 10);
      let now = Date.now();
      if (!currentLeader || (now - leaderTimestamp > LEADER_TIMEOUT)) {
        localStorage.setItem("simulationLeader", myTabId);
        localStorage.setItem("simulationLeaderTimestamp", now.toString());
      }
    }

    /* ---------------- Deterministic Daily Schedule ---------------- */
    // The schedule is based on minutes since midnight (in EST):
    // Times (in minutes): 6:00 = 360, 6:30 = 390, 7:00 = 420, 7:30 = 450, 8:00 = 480, 12:00 = 720,
    // 12:30 = 750, 17:00 = 1020, 17:30 = 1050, 18:30 = 1110, 19:00 = 1140, 22:00 = 1320.
    function getScheduledState(currentMins) {
      // Default: working from home if workLocation is his house.
      const home = "4184 Berkshire Circle, Chattanooga, TN";
      let state = {
        activity: "",
        location: "",
        target_location: "",
        isTraveling: false,
        commuteStart: null,
        commuteEnd: null
      };
      if (currentMins >= 360 && currentMins < 390) {
        state.activity = "Waking up";
        state.location = home;
        state.target_location = home;
      } else if (currentMins >= 390 && currentMins < 420) {
        state.activity = "Showering and getting ready";
        state.location = home;
        state.target_location = home;
      } else if (currentMins >= 420 && currentMins < 450) {
        state.activity = "Having breakfast";
        state.location = home;
        state.target_location = home;
      }
      // Commuting to work if work location is not home.
      else if (currentMins >= 450 && currentMins < 480) {
        if (simulationState.workLocation !== home) {
          state.activity = "Commuting to work";
          state.location = home; // starting from home
          state.target_location = simulationState.workLocation;
          state.isTraveling = true;
          state.commuteStart = 450;
          // Determine travel duration from mapping
          let mapping = locationMapping[simulationState.workLocation];
          // Convert travelTime ms to minutes
          let travelMins = mapping ? mapping.travelTime / 60000 : 10;
          state.commuteEnd = 450 + travelMins;
        } else {
          state.activity = "Starting work at home";
          state.location = home;
          state.target_location = home;
        }
      } else if (currentMins >= 480 && currentMins < 720) {
        state.activity = "Working on Doors";
        // If commuting occurred, location is already work location.
        state.location = (simulationState.workLocation !== home) ? simulationState.workLocation : home;
        state.target_location = state.location;
      } else if (currentMins >= 720 && currentMins < 750) {
        state.activity = (simulationState.workLocation !== home) ? "Having lunch at work" : "Lunch break at home";
        state.location = (simulationState.workLocation !== home) ? simulationState.workLocation : home;
        state.target_location = state.location;
      } else if (currentMins >= 750 && currentMins < 1020) {
        state.activity = "Working on Doors";
        state.location = (simulationState.workLocation !== home) ? simulationState.workLocation : home;
        state.target_location = state.location;
      }
      // Commuting home if work location is not home.
      else if (currentMins >= 1020 && currentMins < 1050) {
        if (simulationState.workLocation !== home) {
          state.activity = "Commuting home";
          state.location = simulationState.workLocation;
          state.target_location = home;
          state.isTraveling = true;
          state.commuteStart = 1020;
          let mapping = locationMapping[simulationState.workLocation];
          let travelMins = mapping ? mapping.travelTime / 60000 : 10;
          state.commuteEnd = 1020 + travelMins;
        } else {
          state.activity = "Finishing work at home";
          state.location = home;
          state.target_location = home;
        }
      } else if (currentMins >= 1050 && currentMins < 1110) {
        state.activity = "Having dinner";
        state.location = home;
        state.target_location = home;
      } else if (currentMins >= 1110 && currentMins < 1140) {
        state.activity = "Showering";
        state.location = home;
        state.target_location = home;
      } else if (currentMins >= 1140 && currentMins < 1320) {
        state.activity = "Relaxing and unwinding";
        state.location = home;
        state.target_location = home;
      } else {
        state.activity = "Sleeping";
        state.location = home;
        state.target_location = home;
      }
      return state;
    }

    /* ---------------- Metrics Update Functions ---------------- */
    // Update physical metrics deterministically based on activity.
    function updateEnergy(deltaSeconds) {
      // Energy change per second: working: -0.1, commuting: -0.05, relaxing: +0.1, sleeping: +0.5, other: 0.
      let rate = 0;
      if (simulationState.current_activity.includes("Working")) {
        rate = -0.1;
      } else if (simulationState.current_activity.includes("Commuting")) {
        rate = -0.05;
      } else if (simulationState.current_activity.includes("Relaxing")) {
        rate = 0.1;
      } else if (simulationState.current_activity.includes("Sleeping")) {
        rate = 0.5;
      }
      simulationState.energyLevel = Math.max(0, Math.min(100, simulationState.energyLevel + rate * deltaSeconds));
    }
    function updateBattery(deltaSeconds) {
      // Battery decreases slowly when not charging.
      let rate = -0.05;
      if (simulationState.phoneCharging) rate = 0.2;
      simulationState.phone_battery = Math.max(0, Math.min(100, simulationState.phone_battery + rate * deltaSeconds));
    }
    function updateHeartRate() {
      // Set heart rate based on activity.
      if (simulationState.current_activity.includes("Sleeping")) return 55;
      if (simulationState.current_activity.includes("Working")) return 75;
      if (simulationState.current_activity.includes("Commuting")) return 80;
      if (simulationState.current_activity.includes("Relaxing")) return 70;
      return 70;
    }
    function updateBodyTemp() {
      // Set a base body temp of 36.8¬∞C (about 98.2¬∞F) with minor variation.
      return (36.8).toFixed(1) + "¬∞C";
    }
    function getCPUUsage() {
      if (simulationState.current_activity.includes("Working")) return 50;
      if (simulationState.current_activity.includes("Relaxing")) return 20;
      if (simulationState.current_activity.includes("Sleeping")) return 5;
      return 15;
    }
    function getNetworkUsage() {
      return { download: 12.0, upload: 3.0 };
    }
    function getUptime() {
      let diff = Date.now() - simulationState.uptimeStart;
      let hours = Math.floor(diff / 3600000);
      let minutes = Math.floor((diff % 3600000) / 60000);
      return `${hours}h ${minutes}m`;
    }
    function getOpenApps() {
      // If usage mode is PC (when working) show a fixed set.
      if (simulationState.current_activity.includes("Working"))
        return "Roblox Studio, Chrome, Discord";
      else
        return "Discord, YouTube";
    }
    function getUsageMode() {
      return simulationState.current_activity.includes("Sleeping") ? "Sleeping" :
             (simulationState.current_activity.includes("Working") ? "PC" : "Phone");
    }

    /* ---------------- Main Update Function (every second) ---------------- */
    let lastUpdateTime = Date.now();
    function updateAllMetrics() {
      tryToBecomeLeader();
      let now = Date.now();
      let deltaSeconds = (now - lastUpdateTime) / 1000;
      lastUpdateTime = now;
      // Update simulation state based on current scheduled routine.
      let currentMins = getTimeInMinutes();
      let sched = getScheduledState(currentMins);
      // If we are in a commuting interval, determine progress.
      if (sched.isTraveling) {
        let commuteProgress = (currentMins - sched.commuteStart) / (sched.commuteEnd - sched.commuteStart);
        if (commuteProgress >= 1) {
          // Commute complete; update current location.
          simulationState.current_location = sched.target_location;
          simulationState.isTraveling = false;
          simulationState.current_activity = sched.activity.includes("Commuting to work") ? "Working on Doors" : "Finishing work at home";
        } else {
          simulationState.isTraveling = true;
          // While commuting, show traveling activity with ETA (in minutes).
          let remaining = Math.max(0, sched.commuteEnd - currentMins);
          simulationState.current_activity = `üöó Traveling to ${sched.target_location} (ETA: ${Math.ceil(remaining)} min)`;
        }
      } else {
        simulationState.current_activity = sched.activity;
        simulationState.current_location = sched.location;
        simulationState.target_location = sched.target_location;
      }
      // Save the updated schedule state.
      saveState(simulationState);

      // Update physical metrics.
      updateEnergy(deltaSeconds);
      updateBattery(deltaSeconds);
      simulationState.persistentHeartRate = updateHeartRate();
      // (Other metrics are determined directly by functions below)

      // Update display.
      updateDisplay();
      updateLeaderHeartbeat();
    }

    /* ---------------- Display Update ---------------- */
    function updateDisplay() {
      document.getElementById("ipField").innerHTML = `<span class="label">üåê IP Address:</span> ${simulationState.current_ip} (updates every ~5 mins)`;
      document.getElementById("locationField").innerHTML = `<span class="label">üìç Location:</span> ${simulationState.current_location}`;
      document.getElementById("deviceField").innerHTML = `<span class="label">üñ•Ô∏è Device Info:</span> ${simulationState.device_info}`;
      document.getElementById("appsField").innerHTML = `<span class="label">${getUsageMode() === "PC" ? "üóÇÔ∏è Open Apps:" : "üì± Mobile Apps:"}</span> ${getOpenApps()}`;
      document.getElementById("cpuField").innerHTML = `<span class="label">üíª CPU Usage:</span> ${getCPUUsage()}%`;
      document.getElementById("uptimeField").innerHTML = `<span class="label">‚è±Ô∏è Uptime:</span> ${getUptime()}`;
      let net = getNetworkUsage();
      document.getElementById("networkField").innerHTML = `<span class="label">üì° Network:</span> ${net.download} Mbps ‚Üì | ${net.upload} Mbps ‚Üë`;
      document.getElementById("headphoneField").innerHTML = `<span class="label">üéß Headphones:</span> On | Volume: 50%`;
      document.getElementById("usageModeField").innerHTML = `<span class="label">üîå Usage Mode:</span> ${getUsageMode()}`;
      
      document.getElementById("heartField").innerHTML = `<span class="label">‚ù§Ô∏è Heart Rate:</span> ${simulationState.persistentHeartRate} BPM`;
      document.getElementById("tempField").innerHTML = `<span class="label">üå°Ô∏è Body Temp:</span> ${updateBodyTemp()}`;
      document.getElementById("energyField").innerHTML = `<span class="label">‚ö° Energy:</span> ${simulationState.energyLevel.toFixed(1)}%`;
      document.getElementById("sleepField").innerHTML = `<span class="label">üõå Sleep:</span> ${getScheduledState(getTimeInMinutes()).activity.includes("Sleeping") ? "Sleeping" : "Awake"}`;
      document.getElementById("lastSeenField").innerHTML = `<span class="label">üëÄ Last Seen:</span> 0 seconds ago`;
      document.getElementById("activityField").innerHTML = `<span class="label">üìä Activity:</span> ${simulationState.current_activity}`;
      document.getElementById("keysField").innerHTML = `<span class="label">‚å®Ô∏è Keystrokes:</span> 100 /min`;
      document.getElementById("phoneField").innerHTML = `<span class="label">üì≤ Phone Battery:</span> ${simulationState.phone_battery.toFixed(1)}% ${simulationState.phoneCharging ? "(Charging)" : "(Discharging)"}`;
      document.getElementById("stressField").innerHTML = `<span class="label">üò∞ Stress:</span> ${simulationState.current_activity.includes("Working") ? "Moderate" : "Low"}`;
      document.getElementById("thoughtField").innerHTML = `<span class="label">üí≠ Thoughts:</span> "Time to focus on Doors"`;
      document.getElementById("timeField").innerHTML = `<span class="label">üï∞Ô∏è EST Time:</span> ${getESTTimeString()}`;
    }

    /* ---------------- Main Loop ---------------- */
    // Update everything every second.
    setInterval(updateAllMetrics, 1000);
  </script>
</body>
</html>
