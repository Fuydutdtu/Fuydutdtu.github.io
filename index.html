<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lsplash Live Tracker</title>
  <style>
    body {
      background-color: #2f3136;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .tracker-container {
      max-width: 750px;
      margin: 0 auto;
      background: #36393f;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      flex: 1;
    }
    .tracker-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .tracker-header img {
      border-radius: 50%;
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .tracker-title {
      font-size: 32px;
      color: #00FF00;
    }
    .section {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #2c2f33;
    }
    .section-title {
      font-size: 24px;
      margin-bottom: 10px;
      color: #00FF00;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .field {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .field span.label {
      display: inline-block;
      width: 210px;
      font-weight: bold;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background: #36393f;
      border-radius: 8px;
      font-size: 14px;
      color: #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    footer img {
      border-radius: 50%;
      width: 30px;
      height: 30px;
    }
  </style>
</head>
<body>
  <div class="tracker-container">
    <div class="tracker-header">
      <img src="images/splash.jpg" alt="Lsplash">
      <div class="tracker-title">Lsplash Live Tracker</div>
    </div>
    <!-- System Data Section -->
    <div class="section" id="systemData">
      <div class="section-title">üñ•Ô∏è System Data</div>
      <div class="field" id="ipField"></div>
      <div class="field" id="locationField"></div>
      <div class="field" id="deviceField"></div>
      <div class="field" id="appsField"></div>
      <div class="field" id="cpuField"></div>
      <div class="field" id="uptimeField"></div>
      <div class="field" id="networkField"></div>
      <div class="field" id="headphoneField"></div>
      <div class="field" id="usageModeField"></div>
    </div>
    <!-- Personal Data Section -->
    <div class="section" id="personalData">
      <div class="section-title">üíì Personal Data</div>
      <div class="field" id="heartField"></div>
      <div class="field" id="tempField"></div>
      <div class="field" id="energyField"></div>
      <div class="field" id="sleepField"></div>
      <div class="field" id="lastSeenField"></div>
      <div class="field" id="activityField"></div>
      <div class="field" id="keysField"></div>
      <div class="field" id="phoneField"></div>
    </div>
    <!-- Mental State Section -->
    <div class="section" id="mentalState">
      <div class="section-title">üß† Mental State</div>
      <div class="field" id="stressField"></div>
      <div class="field" id="thoughtField"></div>
      <div class="field" id="timeField"></div>
    </div>
  </div>

  <!-- Footer Section -->
  <footer>
    <img src="images/pfp.jpg" alt="Profile Picture">
    <div>
      <strong>Made By RobloxEmployee</strong><br>
      Dont Worry, We See You Too üëÄ
    </div>
  </footer>

  <script>
    /* ---------------- Utility Functions ---------------- */
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function getRandomFloat(min, max) {
      return (Math.random() * (max - min) + min).toFixed(1);
    }

    /* ---------------- Location & Activity Data ---------------- */
    // Travel times (in ms):
    // Grocery Store: 8.5 minutes (510,000 ms)
    // Redibles House: 9 minutes (540,000 ms)
    // Jasper's House: 46 minutes (2,760,000 ms)
    const locationMapping = {
      "4184 Berkshire Circle, Chattanooga, TN": { description: "Home", travelTime: 0 },
      "The Fresh Market, 2288 Gunbarrel Rd #124, Chattanooga, TN 37421": { description: "Grocery Store", travelTime: 510000 },
      "1701 Skyline Dr, Chattanooga, TN 37421": { description: "Redibles House", travelTime: 540000 },
      "12033 Haycutter Rd, Birchwood, TN": { description: "Jasper's House", travelTime: 2760000 }
    };
    const addresses = Object.keys(locationMapping);

    /* ---------------- Persistent State ---------------- */
    function getDefaultState() {
      return {
        current_ip: "192.241.0.1",
        ip_set_time: Date.now(),
        current_location: "4184 Berkshire Circle, Chattanooga, TN",
        target_location: "4184 Berkshire Circle, Chattanooga, TN",
        isTraveling: false,
        travelStartTime: null,
        travelDuration: 0,
        device_info: "Windows 11 | Ryzen 7 5800X | RTX 3070",
        energyLevel: getRandomInt(50, 90),
        phone_battery: getRandomInt(50, 80),
        phoneCharging: false,
        current_activity: "Initializing",
        activity_start_time: Date.now(),
        activity_duration: 0,
        persistentHeartRate: getRandomInt(60, 80),
        persistentBodyTemp: 36.5 + (Math.random() - 0.5),
        lastUpdateTime: Date.now()
      };
    }
    function loadState() {
      try {
        let state = localStorage.getItem("simulationState");
        return state ? JSON.parse(state) : null;
      } catch (e) {
        return null;
      }
    }
    function saveState(state) {
      localStorage.setItem("simulationState", JSON.stringify(state));
    }
    let loadedState = loadState();
    simulationState = Object.assign(getDefaultState(), loadedState || {});

    /* ---------------- Leader Election (for multi-tab control) ---------------- */
    const LEADER_TIMEOUT = 2000;
    const myTabId = Date.now() + "-" + Math.random();
    function isLeader() {
      return localStorage.getItem("simulationLeader") === myTabId;
    }
    function updateLeaderHeartbeat() {
      if (isLeader()) {
        localStorage.setItem("simulationLeaderTimestamp", Date.now().toString());
      }
    }
    function tryToBecomeLeader() {
      let currentLeader = localStorage.getItem("simulationLeader");
      let leaderTimestamp = parseInt(localStorage.getItem("simulationLeaderTimestamp") || "0", 10);
      let now = Date.now();
      if (!currentLeader || (now - leaderTimestamp > LEADER_TIMEOUT)) {
        localStorage.setItem("simulationLeader", myTabId);
        localStorage.setItem("simulationLeaderTimestamp", now.toString());
      }
    }

    /* ---------------- Break Sub-Activity Helper ---------------- */
    function getBreakSubActivity() {
      const subActivities = [
        "Taking a Break (Binge Watching Tiktok)",
        "Taking a Break (Having a snack)",
        "Snack Time ‚Äì Grabbing a bite",
        "Taking a Break (Chatting with friends)"
      ];
      return subActivities[getRandomInt(0, subActivities.length - 1)];
    }

    /* ---------------- Logical Activity Scheduler ---------------- */
    // This version uses your detailed schedule:
    // ‚Ä¢ 6:30 ‚Äì 7:00: Wake up, get ready, eat breakfast, watch TV (with precise micro‚Äëactivities)
    // ‚Ä¢ 7:00 ‚Äì 12:08: Work period (with occasional micro‚Äëactivities)
    // ‚Ä¢ 12:08 ‚Äì 12:25: Lunch break (17 minutes)
    // ‚Ä¢ 12:25 ‚Äì 18:30: Afternoon work (with one grocery store trip for 28 minutes around 15:00)
    // ‚Ä¢ 18:30 ‚Äì 20:30: Dinner and a bit of work/relaxing after dinner
    // ‚Ä¢ 20:30 ‚Äì 21:18: Watching TV in bed
    // ‚Ä¢ 21:18 ‚Äì 22:28: Watching TikTok and YouTube until sleep
    // ‚Ä¢ 22:28 ‚Äì 6:30: Sleeping
    function getScheduledActivity() {
      const now = new Date();
      const hour = now.getHours();
      const minute = now.getMinutes();
      const totalMinutes = hour * 60 + minute; // minutes since midnight

      // If energy is zero, force a break
      if (simulationState.energyLevel <= 0) {
        return "Break Time ‚Äì taking a coffee/walk break";
      }

      // 6:30 ‚Äì 7:00 (390‚Äì420 minutes): Morning routine with micro‚Äëactivities
      if (totalMinutes >= 390 && totalMinutes < 420) {
        const microMorning = [
          "Waking up with 100% energy",
          "Rolling out of bed",
          "Walking to the bathroom",
          "Peeing",
          "Taking a quick poop",
          "Brushing teeth",
          "Taking a shower",
          "Getting dressed",
          "Having breakfast",
          "Watching TV for 10‚Äì30 minutes"
        ];
        // Divide the 30‚Äëminute window into equal parts for each activity:
        let partDuration = Math.ceil(30 / microMorning.length);
        let index = Math.floor((totalMinutes - 390) / partDuration);
        if (index >= microMorning.length) index = microMorning.length - 1;
        return microMorning[index];
      }
      // 7:00 ‚Äì 12:08 (420‚Äì728 minutes): Work period with random micro‚Äëactivities
      if (totalMinutes >= 420 && totalMinutes < 728) {
        const workActivities = [
          "Working on projects",
          "Reviewing emails",
          "Taking a short coffee break",
          "Walking to the bathroom to pee",
          "Stretching at the desk",
          "Focused coding session",
          "Brief pause to check notifications"
        ];
        return workActivities[getRandomInt(0, workActivities.length - 1)];
      }
      // 12:08 ‚Äì 12:25 (728‚Äì745 minutes): Lunch break (17 minutes)
      if (totalMinutes >= 728 && totalMinutes < 745) {
        return "Eating lunch (17 minutes)";
      }
      // 12:25 ‚Äì 18:30 (745‚Äì1110 minutes): Afternoon work
      if (totalMinutes >= 745 && totalMinutes < 1110) {
        // Grocery store trip: assume between 15:00 (900) and 15:28 (928) minutes
        if (totalMinutes >= 900 && totalMinutes < 928) {
          return "At the grocery store (28 minutes)";
        }
        const afternoonActivities = [
          "Working on projects",
          "Taking a quick coffee break",
          "Walking to the bathroom (pee)",
          "Stretching and refocusing",
          "Answering emails"
        ];
        return afternoonActivities[getRandomInt(0, afternoonActivities.length - 1)];
      }
      // 18:30 ‚Äì 20:30 (1110‚Äì1230 minutes): Evening routine ‚Äì dinner then light work/relaxation
      if (totalMinutes >= 1110 && totalMinutes < 1230) {
        if (totalMinutes < 1125) { // first 15 minutes for dinner
          return "Eating dinner";
        } else {
          return "Light work or relaxing after dinner";
        }
      }
      // 20:30 ‚Äì 21:18 (1230‚Äì1278 minutes): TV in bed
      if (totalMinutes >= 1230 && totalMinutes < 1278) {
        return "Watching TV in bed";
      }
      // 21:18 ‚Äì 22:28 (1278‚Äì1348 minutes): TikTok and YouTube time
      if (totalMinutes >= 1278 && totalMinutes < 1348) {
        return "Watching TikTok and YouTube";
      }
      // Else, it's sleeping time (22:28‚Äì6:30)
      return "Sleeping";
    }

    /* ---------------- Simulation Functions ---------------- */
    function computeDeltaTime() {
      const now = Date.now();
      const dt = (now - simulationState.lastUpdateTime) / 60000;
      simulationState.lastUpdateTime = now;
      return dt;
    }
    function updateIPAndLocation(now) {
      if (now - simulationState.ip_set_time >= 5 * 60 * 1000) {
        simulationState.current_ip = `192.241.${getRandomInt(0, 255)}.${getRandomInt(0, 255)}`;
        simulationState.ip_set_time = now;
      }
      if (!simulationState.isTraveling && !simulationState.current_activity.toLowerCase().includes("break")) {
        if (Math.random() < 0.05) {
          let newTarget = addresses[getRandomInt(0, addresses.length - 1)];
          if (newTarget === "The Fresh Market, 2288 Gunbarrel Rd #124, Chattanooga, TN 37421" &&
              simulationState.current_location !== "4184 Berkshire Circle, Chattanooga, TN") {
            newTarget = "4184 Berkshire Circle, Chattanooga, TN";
          }
          if (newTarget !== simulationState.current_location) {
            simulationState.target_location = newTarget;
            simulationState.isTraveling = true;
            simulationState.travelStartTime = now;
            let mapping = locationMapping[newTarget];
            simulationState.travelDuration = mapping ? mapping.travelTime : getRandomInt(180,600)*1000;
          }
        }
      }
    }
    function updateTravel(now) {
      if (simulationState.isTraveling) {
        if (now - simulationState.travelStartTime >= simulationState.travelDuration) {
          simulationState.current_location = simulationState.target_location;
          simulationState.isTraveling = false;
        }
      }
    }
    function getESTTime() {
      let now = new Date();
      let utc = now.getTime() + now.getTimezoneOffset() * 60000;
      let est = new Date(utc - (5 * 3600000));
      let hours = est.getHours();
      let minutes = est.getMinutes();
      let ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      return `${hours}:${minutes} ${ampm}`;
    }
    function getSleepStatus() {
      let hour = new Date().getHours();
      if (hour >= 23 || hour < 6) return "üí§ Deep Sleeping";
      if (hour >= 13 && hour < 15 && Math.random() < 0.5) return "üò¥ Light Napping";
      return "Awake";
    }
    function updateActivityState(now, sleepStatus) {
      if (simulationState.energyLevel <= 0) {
        if (simulationState.current_location !== "4184 Berkshire Circle, Chattanooga, TN") {
          simulationState.target_location = "4184 Berkshire Circle, Chattanooga, TN";
          simulationState.isTraveling = true;
          simulationState.travelStartTime = now;
          simulationState.travelDuration = locationMapping["4184 Berkshire Circle, Chattanooga, TN"].travelTime;
          simulationState.current_activity = "üöó Traveling home for break";
          simulationState.activity_start_time = now;
          return;
        } else {
          simulationState.current_activity = getBreakSubActivity();
          simulationState.activity_start_time = now;
          simulationState.activity_duration = Infinity;
          return;
        }
      }
      if (sleepStatus.includes("Sleeping") || sleepStatus.includes("Napping")) {
        simulationState.current_activity = sleepStatus;
        simulationState.activity_duration = Infinity;
        simulationState.activity_start_time = now;
        return;
      }
      if (simulationState.isTraveling) {
        let mapping = locationMapping[simulationState.target_location];
        let elapsed = now - simulationState.travelStartTime;
        let remaining = simulationState.travelDuration - elapsed;
        simulationState.current_activity = `üöó Traveling to ${simulationState.target_location} (${mapping ? mapping.description : "Unknown"}, ETA: ${remaining > 0 ? Math.ceil(remaining/60000) : 0} min)`;
        simulationState.activity_duration = simulationState.travelDuration;
        simulationState.activity_start_time = simulationState.travelStartTime;
        return;
      }
      let scheduled = getScheduledActivity();
      if (scheduled.includes("Commuting")) {
        if (scheduled.includes("Redibles")) {
          simulationState.target_location = "1701 Skyline Dr, Chattanooga, TN 37421";
        } else if (scheduled.includes("Jasper")) {
          simulationState.target_location = "12033 Haycutter Rd, Birchwood, TN";
        } else if (scheduled.includes("grocery")) {
          simulationState.target_location = "The Fresh Market, 2288 Gunbarrel Rd #124, Chattanooga, TN 37421";
        } else if (scheduled.includes("home")) {
          simulationState.target_location = "4184 Berkshire Circle, Chattanooga, TN";
        }
        if (simulationState.current_location !== simulationState.target_location) {
          simulationState.isTraveling = true;
          simulationState.travelStartTime = now;
          let mapping = locationMapping[simulationState.target_location];
          simulationState.travelDuration = mapping ? mapping.travelTime : getRandomInt(180,600)*1000;
          simulationState.current_activity = scheduled;
          simulationState.activity_duration = simulationState.travelDuration;
          simulationState.activity_start_time = now;
          return;
        }
      }
      simulationState.current_activity = scheduled;
      simulationState.activity_duration = getRandomInt(300,900);
      simulationState.activity_start_time = now;
    }
    function updatePhoneBattery(dtMinutes) {
      if (!simulationState.phoneCharging) {
        simulationState.phone_battery -= dtMinutes * 2;
        if (simulationState.phone_battery <= 15) simulationState.phoneCharging = true;
      } else {
        simulationState.phone_battery += dtMinutes * 5;
        if (simulationState.phone_battery >= 100) {
          simulationState.phone_battery = 100;
          simulationState.phoneCharging = false;
        }
      }
      if (simulationState.phone_battery < 0) simulationState.phone_battery = 0;
    }
    function updateEnergyLevel(dtMinutes, sleepStatus) {
      if (sleepStatus.includes("Sleeping") || sleepStatus.includes("Napping") ||
         simulationState.current_activity.toLowerCase().includes("break") ||
         simulationState.current_activity.toLowerCase().includes("snack")) {
        simulationState.energyLevel += dtMinutes * 4;
      } else {
        simulationState.energyLevel -= dtMinutes * 1;
      }
      simulationState.energyLevel = Math.min(Math.max(simulationState.energyLevel, 0), 100);
    }
    function updateHeartRate() {
      if (simulationState.current_activity && (simulationState.current_activity.includes("Sleeping") ||
          simulationState.current_activity.includes("Napping"))) {
        simulationState.persistentHeartRate += simulationState.persistentHeartRate > 55 ? -getRandomInt(1,3) : getRandomInt(0,1);
      } else {
        simulationState.persistentHeartRate += getRandomInt(-2,2);
      }
      simulationState.persistentHeartRate = Math.min(Math.max(simulationState.persistentHeartRate, 50), 110);
      return simulationState.persistentHeartRate;
    }
    function updateBodyTemp() {
      if (simulationState.current_activity && (simulationState.current_activity.includes("Sleeping") ||
          simulationState.current_activity.includes("Napping"))) {
        simulationState.persistentBodyTemp -= Math.abs((Math.random()-0.5)*0.2);
      } else {
        simulationState.persistentBodyTemp += (Math.random()-0.5)*0.2;
      }
      if (simulationState.current_activity && (simulationState.current_activity.includes("Sleeping") ||
          simulationState.current_activity.includes("Napping"))) {
        simulationState.persistentBodyTemp = Math.min(Math.max(simulationState.persistentBodyTemp,35.5),37.0);
      } else {
        simulationState.persistentBodyTemp = Math.min(Math.max(simulationState.persistentBodyTemp,36.0),37.5);
      }
      let fahrenheit = (simulationState.persistentBodyTemp * 9/5)+32;
      return fahrenheit.toFixed(1)+"¬∞F";
    }
    function getStressLevel(activity) {
      if (activity && activity.includes("Doors") && !activity.includes("Traveling")) return "üò∞ High";
      return activity && activity.includes("Traveling") ? "üòê Moderate" : (Math.random()<0.5 ? "üòå Low" : "üòê Moderate");
    }
    function getThoughtProcess() {
      if (simulationState.current_activity && simulationState.current_activity.includes("Traveling")) {
        const travelThoughts = [
          "I hope traffic clears soon.",
          "Maybe I'll listen to some tunes while driving.",
          "I should check the route for delays.",
          "Looking forward to arriving soon."
        ];
        return travelThoughts[getRandomInt(0, travelThoughts.length - 1)];
      }
      if (simulationState.current_activity && 
         (simulationState.current_activity.toLowerCase().includes("break") ||
          simulationState.current_activity.toLowerCase().includes("snack"))) {
        return "I'm taking a well-deserved break and rethinking life.";
      }
      if (simulationState.current_activity && simulationState.current_activity.includes("Working")) {
        return "Time to focus on my code and finish these tasks.";
      }
      const baseThoughts = [
        "Maybe a quick coffee break will help.",
        "Time to check some game stats.",
        "I need to relax for a moment."
      ];
      return baseThoughts[getRandomInt(0, baseThoughts.length - 1)];
    }

    function updateSlowDisplay() {
      console.log("Updating display...");
      document.getElementById("ipField").innerHTML = `<span class="label">üåê IP Address:</span> ${simulationState.current_ip} (updates every ~5 mins)`;
      let locationDisplay = simulationState.isTraveling 
        ? `üöó Traveling to ${simulationState.target_location} (ETA: ${Math.ceil((simulationState.travelDuration - (Date.now() - simulationState.travelStartTime))/60000)} min)`
        : simulationState.current_location;
      document.getElementById("locationField").innerHTML = `<span class="label">üìç Location:</span> ${locationDisplay}`;
      document.getElementById("deviceField").innerHTML = `<span class="label">üñ•Ô∏è Device Info:</span> ${simulationState.device_info}`;
      let usageMode = simulationState.isTraveling ? "Car" :
                      (getSleepStatus().includes("Sleeping") || getSleepStatus().includes("Napping") ? "Sleeping" : (Math.random()<0.5 ? "PC" : "Phone"));
      let openApps = (usageMode==="PC" && !simulationState.isTraveling) ? getOpenApplications() : ["Discord", "YouTube"];
      document.getElementById("appsField").innerHTML = `<span class="label">${usageMode==="PC" ? "üóÇÔ∏è Open Apps:" : "üì± Mobile Apps:"}</span> ${openApps.join(", ")}`;
      document.getElementById("cpuField").innerHTML = `<span class="label">üíª CPU Usage:</span> ${getRandomInt(10,50)}%`;
      document.getElementById("uptimeField").innerHTML = `<span class="label">‚è±Ô∏è Uptime:</span> ${getRandomInt(1,12)}h ${getRandomInt(0,59)}m`;
      let network = { download: getRandomFloat(5,15), upload: getRandomFloat(1,5) };
      document.getElementById("networkField").innerHTML = `<span class="label">üì° Network:</span> ${network.download} Mbps ‚Üì | ${network.upload} Mbps ‚Üë`;
      let headphoneStatus = Math.random()<0.5 ? "üéß On" : "‚ùå Off";
      let headphoneVolume = headphoneStatus==="üéß On" ? `${getRandomInt(10,100)}%` : "N/A";
      document.getElementById("headphoneField").innerHTML = `<span class="label">üéß Headphones:</span> ${headphoneStatus} | Volume: ${headphoneVolume}`;
      document.getElementById("usageModeField").innerHTML = `<span class="label">üîå Usage Mode:</span> ${usageMode}`;
      
      // If traveling, update the activity text with ETA.
      let activityDisplay = simulationState.current_activity;
      if(simulationState.isTraveling) {
        let eta = Math.ceil((simulationState.travelDuration - (Date.now()-simulationState.travelStartTime))/60000);
        // If commuting home, show "Commuting home (ETA: X min)"
        if(simulationState.target_location === "4184 Berkshire Circle, Chattanooga, TN") {
          activityDisplay = "üöó Commuting home (ETA: " + eta + " min)";
        } else {
          activityDisplay = simulationState.current_activity + " (ETA: " + eta + " min)";
        }
      }
      document.getElementById("activityField").innerHTML = `<span class="label">üìä Activity:</span> ${activityDisplay}`;
      let keystrokes = simulationState.isTraveling || simulationState.current_activity.toLowerCase().includes("break") || simulationState.current_activity.toLowerCase().includes("snack")
                        ? 0 : getRandomInt(50,200);
      document.getElementById("keysField").innerHTML = `<span class="label">‚å®Ô∏è Keystrokes:</span> ${keystrokes} /min`;
      document.getElementById("heartField").innerHTML = `<span class="label">‚ù§Ô∏è Heart Rate:</span> ${updateHeartRate()} BPM`;
      document.getElementById("tempField").innerHTML = `<span class="label">üå°Ô∏è Body Temp:</span> ${updateBodyTemp()}`;
      document.getElementById("energyField").innerHTML = `<span class="label">‚ö° Energy:</span> ${simulationState.energyLevel.toFixed(0)}%`;
      document.getElementById("sleepField").innerHTML = `<span class="label">üõå Sleep:</span> ${getSleepStatus()}`;
      document.getElementById("lastSeenField").innerHTML = `<span class="label">üëÄ Last Seen:</span> ${getRandomInt(1,15)} seconds ago`;
      document.getElementById("phoneField").innerHTML = `<span class="label">üì≤ Phone Battery:</span> ${Math.round(simulationState.phone_battery)}% ${simulationState.phoneCharging ? "(Charging)" : "(Discharging)"}`;
      document.getElementById("stressField").innerHTML = `<span class="label">üò∞ Stress:</span> ${getStressLevel(simulationState.current_activity)}`;
      document.getElementById("thoughtField").innerHTML = `<span class="label">üí≠ Thoughts:</span> "${getThoughtProcess()}"`;
    }
    function updateTimeField() {
      document.getElementById("timeField").innerHTML = `<span class="label">üï∞Ô∏è EST Time:</span> ${getESTTime()}`;
    }

    function updateSlowMetrics() {
      tryToBecomeLeader();
      let storedState = loadState();
      simulationState = Object.assign(getDefaultState(), storedState || {});
      const now = Date.now();
      const dtMinutes = computeDeltaTime();
      const sleepStatus = getSleepStatus();
      updateIPAndLocation(now);
      updateTravel(now);
      updateActivityState(now, sleepStatus);
      updatePhoneBattery(dtMinutes);
      updateEnergyLevel(dtMinutes, sleepStatus);
      saveState(simulationState);
      updateLeaderHeartbeat();
      updateSlowDisplay();
    }

    updateSlowMetrics();
    updateTimeField();
    setInterval(updateSlowMetrics, 30000);
    setInterval(updateTimeField, 1000);
    window.addEventListener("beforeunload", function() {
      saveState(simulationState);
    });
  </script>
</body>
</html>
