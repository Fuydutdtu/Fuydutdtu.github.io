<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lsplash Live Tracker</title>
  <style>
    /* (CSS omitted for brevity; use your existing CSS) */
    body {
      background-color: #2f3136;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .tracker-container {
      max-width: 750px;
      margin: 0 auto;
      background: #36393f;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      flex: 1;
    }
    .tracker-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .tracker-header img {
      border-radius: 50%;
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .tracker-title {
      font-size: 32px;
      color: #00FF00;
    }
    .section {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #2c2f33;
    }
    .section-title {
      font-size: 24px;
      margin-bottom: 10px;
      color: #00FF00;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .field {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .field span.label {
      display: inline-block;
      width: 210px;
      font-weight: bold;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      background: #36393f;
      border-radius: 8px;
      font-size: 14px;
      color: #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    footer img {
      border-radius: 50%;
      width: 30px;
      height: 30px;
    }
  </style>
</head>
<body>
  <div class="tracker-container">
    <div class="tracker-header">
      <img src="images/splash.jpg" alt="Lsplash">
      <div class="tracker-title">Lsplash Live Tracker</div>
    </div>
    <!-- System Data Section -->
    <div class="section" id="systemData">
      <div class="section-title">üñ•Ô∏è System Data</div>
      <div class="field" id="ipField"></div>
      <div class="field" id="locationField"></div>
      <div class="field" id="deviceField"></div>
      <div class="field" id="appsField"></div>
      <div class="field" id="cpuField"></div>
      <div class="field" id="uptimeField"></div>
      <div class="field" id="networkField"></div>
      <div class="field" id="headphoneField"></div>
      <div class="field" id="usageModeField"></div>
    </div>
    <!-- Personal Data Section -->
    <div class="section" id="personalData">
      <div class="section-title">üíì Personal Data</div>
      <div class="field" id="heartField"></div>
      <div class="field" id="tempField"></div>
      <div class="field" id="energyField"></div>
      <div class="field" id="sleepField"></div>
      <div class="field" id="lastSeenField"></div>
      <div class="field" id="activityField"></div>
      <div class="field" id="keysField"></div>
      <div class="field" id="phoneField"></div>
    </div>
    <!-- Mental State Section -->
    <div class="section" id="mentalState">
      <div class="section-title">üß† Mental State</div>
      <div class="field" id="stressField"></div>
      <div class="field" id="thoughtField"></div>
      <div class="field" id="timeField"></div>
    </div>
  </div>

  <!-- Footer Section -->
  <footer>
    <img src="images/pfp.jpg" alt="Profile Picture">
    <div>
      <strong>Made By RobloxEmployee</strong><br>
      Detailed tracking for your door development day.
    </div>
  </footer>

  <script>
    /* ---------------- Utility Functions ---------------- */
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function getRandomFloat(min, max) {
      return (Math.random() * (max - min) + min).toFixed(1);
    }
    function getMinutesSinceMidnight() {
      const now = new Date();
      return now.getHours() * 60 + now.getMinutes();
    }

    /* ---------------- Load External JSON Data ---------------- */
    async function loadJSON(url) {
      try {
        let response = await fetch(url);
        if (response.ok) return await response.json();
      } catch(e) {
        console.error("Error loading JSON from", url, e);
      }
      return null;
    }
    // Load thoughts and activities from files in the /data folder.
    let thoughtsList = [];
    let activitiesList = [];
    async function loadExternalData() {
      thoughtsList = await loadJSON('/data/thoughts.json') || [];
      activitiesList = await loadJSON('/data/activities.json') || [];
    }
    const defaultThoughts = [ 
      "Time to optimize the door collision detection algorithm.",
      "Reviewing the door unlocking logic‚Äîtighten security.",
      "Maybe add a subtle ambient sound for door opening.",
      "Refactoring the door state machine for better performance.",
      "Brainstorming a hidden door easter egg idea."
      // ... (extend to 100+ entries as needed)
    ];
    const defaultActivities = [
      "Review door code documentation",
      "Optimize door collision detection",
      "Refactor the door state machine",
      "Test door animation transitions",
      "Debug door unlocking issues"
      // ... (extend to 50+ entries as needed)
    ];
    function getRandomThought() {
      const list = thoughtsList.length ? thoughtsList : defaultThoughts;
      return list[getRandomInt(0, list.length - 1)];
    }
    function getRandomActivity() {
      const list = activitiesList.length ? activitiesList : defaultActivities;
      return list[getRandomInt(0, list.length - 1)];
    }
    function getThoughtProcess() {
      return getRandomThought();
    }
    function getAdditionalActivity() {
      return getRandomActivity();
    }

    /* ---------------- Fallback for getOpenApplications ---------------- */
    function getOpenApplications() {
      // Return a simple list of applications.
      return ["Roblox Studio", "VSCode", "Discord"];
    }

    /* ---------------- Schedule Data ---------------- */
    const locationMapping = {
      "Home": { description: "Home", travelTime: 0 },
      "Redibles": { description: "At Redibles", travelTime: 5 * 60000 },
      "Jasper's House": { description: "At Jasper's House", travelTime: 8 * 60000 }
    };
    const addresses = Object.keys(locationMapping);
    const dailySchedule = [
      { start: 390, end: 405, activity: "üöΩ Morning Routine: Wake up, bathroom, brush teeth" },
      { start: 405, end: 435, activity: "‚òï Breakfast & Daily Planning" },
      { start: 435, end: 480, activity: "üìß Check emails and review schedule" },
      { start: 480, end: 600, activity: "üíª Coding & Debugging Door Mechanics" },
      { start: 600, end: 615, activity: "üîÑ Short Break: Stretch, quick snack" },
      { start: 615, end: 720, activity: "üé® Designing New Door Features & Animations" },
      { start: 720, end: 750, activity: "üç¥ Lunch Break" },
      { start: 750, end: 900, activity: "üö™ Intensive Development: Implement & test door logic" },
      { start: 900, end: 915, activity: "‚òï Afternoon Break: Bathroom & coffee" },
      { start: 915, end: 1020, activity: "ü§ù Collaboration: Video calls with Redibles/Jasper, brainstorming door lore" },
      { start: 1020, end: 1080, activity: "üöÄ Prototyping & Testing: Refining door animations and code" },
      { start: 1080, end: 1230, activity: "üéÆ Creative Break: Play Ragdoll Universe & review ideas" },
      { start: 1230, end: 1348, activity: "üåô Wind Down: Wrap up work, plan next day, personal time" }
    ];

    /* ---------------- Server-Based State Persistence ---------------- */
    async function loadStateFromServer() {
      try {
        let response = await fetch('/data/state.json');
        if (response.ok) return await response.json();
      } catch(e) {
        console.error("Error loading state from server:", e);
      }
      return getDefaultState();
    }
    async function saveStateToServer(state) {
      try {
        await fetch('/data/state.json', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(state)
        });
      } catch(e) {
        console.error("Error saving state to server:", e);
      }
    }
    function getDefaultState() {
      return {
        current_ip: "192.241.0.1",
        ip_set_time: Date.now(),
        current_location: "Home",
        target_location: "Home",
        isTraveling: false,
        travelStartTime: null,
        travelDuration: 0,
        device_info: "Windows 11 | Ryzen 7 5800X | RTX 3070",
        energyLevel: 80,
        phone_battery: 75,
        phoneCharging: false,
        current_activity: "Initializing",
        activity_start_time: Date.now(),
        activity_duration: 0,
        persistentHeartRate: 70,
        persistentBodyTemp: 36.5,
        lastUpdateTime: Date.now(),
        lastSeen: getRandomInt(1,15),
        keystrokes: 160,
        cpuUsage: getRandomInt(10,50),
        uptimeHours: getRandomInt(1,12),
        uptimeMinutes: getRandomInt(0,59),
        networkDownload: getRandomFloat(5,15),
        networkUpload: getRandomFloat(1,5),
        headphoneStatus: Math.random() < 0.5 ? "üéß On" : "‚ùå Off",
        headphoneVolume: "N/A"
      };
    }

    /* ---------------- Global Simulation State ---------------- */
    let simulationState = {};

    /* ---------------- Initialization ---------------- */
    async function init() {
      await loadExternalData(); // load thoughts and activities from files
      simulationState = await loadStateFromServer();
      if (!simulationState) simulationState = getDefaultState();
      simulationState.headphoneVolume = simulationState.headphoneStatus === "üéß On" ? `${getRandomInt(10,100)}%` : "N/A";
      simulationState.lastUpdateTime = Date.now();
      updateSlowMetrics();
      updateTimeField();
      setInterval(updateSlowMetrics, 30000);
      setInterval(updateTimeField, 1000);
    }
    init();

    /* ---------------- Leader Election (for multi-tab control) ---------------- */
    const LEADER_TIMEOUT = 2000;
    const myTabId = Date.now() + "-" + Math.random();
    function isLeader() {
      return localStorage.getItem("simulationLeader") === myTabId;
    }
    function updateLeaderHeartbeat() {
      if (isLeader()) {
        localStorage.setItem("simulationLeaderTimestamp", Date.now().toString());
      }
    }
    function tryToBecomeLeader() {
      let currentLeader = localStorage.getItem("simulationLeader");
      let leaderTimestamp = parseInt(localStorage.getItem("simulationLeaderTimestamp") || "0", 10);
      let now = Date.now();
      if (!currentLeader || (now - leaderTimestamp > LEADER_TIMEOUT)) {
        localStorage.setItem("simulationLeader", myTabId);
        localStorage.setItem("simulationLeaderTimestamp", now.toString());
      }
    }

    /* ---------------- Scheduled Activity Function ---------------- */
    function getScheduledActivity() {
      const nowMin = getMinutesSinceMidnight();
      if (simulationState.energyLevel <= 0) {
        if (simulationState.current_location !== "Home") {
          simulationState.target_location = "Home";
          simulationState.isTraveling = true;
          simulationState.travelStartTime = Date.now();
          simulationState.travelDuration = locationMapping["Home"].travelTime;
          return "üöó Traveling Home for a Power Nap";
        }
        return "‚òï Taking a Break to Recharge";
      }
      if (simulationState.isTraveling) {
        let elapsed = Date.now() - simulationState.travelStartTime;
        let remaining = simulationState.travelDuration - elapsed;
        let eta = Math.ceil(remaining / 60000);
        if (eta < 1) eta = 1;
        return `üöó Traveling to ${simulationState.target_location} (ETA: ${eta} min)`;
      }
      let scheduled = dailySchedule.find(slot => nowMin >= slot.start && nowMin < slot.end);
      return scheduled ? scheduled.activity : "üíª Idle (reviewing door code)";
    }

    /* ---------------- Simulation Functions ---------------- */
    function computeDeltaTime() {
      const now = Date.now();
      const dt = (now - simulationState.lastUpdateTime) / 60000;
      simulationState.lastUpdateTime = now;
      return dt;
    }
    function updateIPAndLocation(now) {
      if (now - simulationState.ip_set_time >= 5 * 60 * 1000) {
        simulationState.current_ip = `192.241.${getRandomInt(0, 255)}.${getRandomInt(0, 255)}`;
        simulationState.ip_set_time = now;
      }
      if (!simulationState.isTraveling && Math.random() < 0.03) {
        let newTarget = addresses[getRandomInt(0, addresses.length - 1)];
        if (newTarget !== simulationState.current_location) {
          simulationState.target_location = newTarget;
          simulationState.isTraveling = true;
          simulationState.travelStartTime = now;
          simulationState.travelDuration = locationMapping[newTarget].travelTime;
        }
      }
    }
    function updateTravel(now) {
      if (simulationState.isTraveling) {
        if (now - simulationState.travelStartTime >= simulationState.travelDuration) {
          simulationState.current_location = simulationState.target_location;
          simulationState.isTraveling = false;
        }
      }
    }
    function getESTTime() {
      let now = new Date();
      let utc = now.getTime() + now.getTimezoneOffset() * 60000;
      let est = new Date(utc - (5 * 3600000));
      let hours = est.getHours();
      let minutes = est.getMinutes();
      let ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      return `${hours}:${minutes} ${ampm}`;
    }
    function getSleepStatus() {
      const nowMin = getMinutesSinceMidnight();
      if (nowMin < 390 || nowMin >= 1348) return "üí§ Sleeping";
      if (nowMin >= 750 && nowMin < 765) return "üò¥ Short Nap";
      return "Awake";
    }
    function updateActivityState(now) {
      let sleepStatus = getSleepStatus();
      if (sleepStatus.includes("Sleeping") || sleepStatus.includes("Nap")) {
        simulationState.current_activity = sleepStatus;
        simulationState.activity_duration = Infinity;
        simulationState.activity_start_time = now;
        return;
      }
      simulationState.current_activity = getScheduledActivity();
      simulationState.activity_duration = 600;
      simulationState.activity_start_time = now;
    }
    function updatePhoneBattery(dtMinutes) {
      if (!simulationState.phoneCharging) {
        simulationState.phone_battery -= dtMinutes * 2;
        if (simulationState.phone_battery <= 15) simulationState.phoneCharging = true;
      } else {
        simulationState.phone_battery += dtMinutes * 5;
        if (simulationState.phone_battery >= 100) {
          simulationState.phone_battery = 100;
          simulationState.phoneCharging = false;
        }
      }
      if (simulationState.phone_battery < 0) simulationState.phone_battery = 0;
    }
    function updateEnergyLevel(dtMinutes) {
      if (simulationState.current_activity.includes("Sleeping") ||
          simulationState.current_activity.includes("Break") ||
          simulationState.current_activity.includes("Nap") ||
          simulationState.current_activity.includes("Wind Down")) {
        simulationState.energyLevel += dtMinutes * 4;
      } else if (simulationState.current_activity.includes("Coding") ||
                 simulationState.current_activity.includes("Debug") ||
                 simulationState.current_activity.includes("Designing") ||
                 simulationState.current_activity.includes("Development") ||
                 simulationState.current_activity.includes("Prototyping")) {
        simulationState.energyLevel -= dtMinutes * 0.7;
      } else if (simulationState.current_activity.includes("Collaboration") ||
                 simulationState.current_activity.includes("Creative Break")) {
        simulationState.energyLevel -= dtMinutes * 0.4;
      } else {
        simulationState.energyLevel -= dtMinutes * 0.2;
      }
      simulationState.energyLevel = Math.min(Math.max(simulationState.energyLevel, 0), 100);
    }
    function updateHeartRate() {
      if (simulationState.current_activity.includes("Sleeping") ||
          simulationState.current_activity.includes("Nap")) {
        simulationState.persistentHeartRate = Math.max(simulationState.persistentHeartRate - 1, 55);
      }
      return simulationState.persistentHeartRate;
    }
    function updateBodyTemp() {
      if (simulationState.current_activity.includes("Sleeping") ||
          simulationState.current_activity.includes("Nap")) {
        simulationState.persistentBodyTemp = 36.5;
      }
      let fahrenheit = (simulationState.persistentBodyTemp * 9/5) + 32;
      return fahrenheit.toFixed(1) + "¬∞F";
    }
    function getStressLevel(activity) {
      if (activity.includes("Debug") || activity.includes("Coding")) return "üò∞ High";
      if (activity.includes("Break") || activity.includes("Wind Down")) return "üòå Low";
      return "üòê Moderate";
    }
    function updateSlowDisplay() {
      document.getElementById("ipField").innerHTML = `<span class="label">üåê IP Address:</span> ${simulationState.current_ip} (updates every ~5 mins)`;
      let locationDisplay = simulationState.isTraveling 
        ? `üöó Traveling to ${simulationState.target_location} (ETA: ${Math.ceil(Math.max((simulationState.travelDuration - (Date.now() - simulationState.travelStartTime))/60000, 1))} min)`
        : simulationState.current_location;
      document.getElementById("locationField").innerHTML = `<span class="label">üìç Location:</span> ${locationDisplay}`;
      let sleepStatus = getSleepStatus();
      let usageMode = simulationState.isTraveling ? "Car" :
                      (sleepStatus.includes("Sleeping") || sleepStatus.includes("Nap") ? "Sleeping" : "PC");
      document.getElementById("usageModeField").innerHTML = `<span class="label">üîå Usage Mode:</span> ${usageMode}`;
      let deviceInfo = usageMode === "PC" ? simulationState.device_info :
                       (usageMode === "Sleeping" ? "No active device (Sleeping)" : "iPhone 13 | iOS 15");
      document.getElementById("deviceField").innerHTML = `<span class="label">üñ•Ô∏è Device Info:</span> ${deviceInfo}`;
      let openApps = getOpenApplications();
      document.getElementById("appsField").innerHTML = `<span class="label">${usageMode==="PC" ? "üóÇÔ∏è Open Apps:" : "üì± Mobile Apps:"}</span> ${openApps.join(", ")}`;
      document.getElementById("cpuField").innerHTML = `<span class="label">üíª CPU Usage:</span> ${simulationState.cpuUsage}%`;
      document.getElementById("uptimeField").innerHTML = `<span class="label">‚è±Ô∏è Uptime:</span> ${simulationState.uptimeHours}h ${simulationState.uptimeMinutes}m`;
      document.getElementById("networkField").innerHTML = `<span class="label">üì° Network:</span> ${simulationState.networkDownload} Mbps ‚Üì | ${simulationState.networkUpload} Mbps ‚Üë`;
      document.getElementById("headphoneField").innerHTML = `<span class="label">üéß Headphones:</span> ${simulationState.headphoneStatus} | Volume: ${simulationState.headphoneVolume}`;
      let activityDisplay = simulationState.current_activity;
      if (simulationState.isTraveling) {
        let remaining = simulationState.travelDuration - (Date.now() - simulationState.travelStartTime);
        let eta = Math.ceil(remaining / 60000);
        if (eta < 1) eta = 1;
        activityDisplay = simulationState.target_location === "Home" ?
                          "üöó Commuting home (ETA: " + eta + " min)" :
                          simulationState.current_activity + " (ETA: " + eta + " min)";
      }
      document.getElementById("activityField").innerHTML = `<span class="label">üìä Activity:</span> ${activityDisplay}`;
      document.getElementById("keysField").innerHTML = `<span class="label">‚å®Ô∏è Keystrokes:</span> ${simulationState.keystrokes} /min`;
      document.getElementById("heartField").innerHTML = `<span class="label">‚ù§Ô∏è Heart Rate:</span> ${updateHeartRate()} BPM`;
      document.getElementById("tempField").innerHTML = `<span class="label">üå°Ô∏è Body Temp:</span> ${updateBodyTemp()}`;
      document.getElementById("energyField").innerHTML = `<span class="label">‚ö° Energy:</span> ${simulationState.energyLevel.toFixed(0)}%`;
      document.getElementById("sleepField").innerHTML = `<span class="label">üõå Sleep:</span> ${sleepStatus}`;
      document.getElementById("lastSeenField").innerHTML = `<span class="label">üëÄ Last Seen:</span> ${simulationState.lastSeen} sec ago`;
      document.getElementById("phoneField").innerHTML = `<span class="label">üì≤ Phone Battery:</span> ${Math.round(simulationState.phone_battery)}% ${simulationState.phoneCharging ? "(Charging)" : "(Discharging)"}`;
      document.getElementById("stressField").innerHTML = `<span class="label">üò∞ Stress:</span> ${getStressLevel(simulationState.current_activity)}`;
      document.getElementById("thoughtField").innerHTML = `<span class="label">üí≠ Thoughts:</span> "${getThoughtProcess()}"`;
    }
    function updateTimeField() {
      document.getElementById("timeField").innerHTML = `<span class="label">üï∞Ô∏è EST Time:</span> ${getESTTime()}`;
    }
    async function updateSlowMetrics() {
      tryToBecomeLeader();
      const now = Date.now();
      const dtMinutes = computeDeltaTime();
      updateIPAndLocation(now);
      updateTravel(now);
      updateActivityState(now);
      updatePhoneBattery(dtMinutes);
      updateEnergyLevel(dtMinutes);
      if (Math.random() < 0.2) {
        simulationState.lastSeen = getRandomInt(1,15);
        simulationState.keystrokes = simulationState.isTraveling || simulationState.current_activity.toLowerCase().includes("break")
                                      ? 0 : getRandomInt(50,200);
        simulationState.cpuUsage = getRandomInt(10,50);
        simulationState.uptimeHours = getRandomInt(1,12);
        simulationState.uptimeMinutes = getRandomInt(0,59);
        simulationState.networkDownload = getRandomFloat(5,15);
        simulationState.networkUpload = getRandomFloat(1,5);
        simulationState.headphoneStatus = Math.random() < 0.5 ? "üéß On" : "‚ùå Off";
        simulationState.headphoneVolume = simulationState.headphoneStatus === "üéß On" ? `${getRandomInt(10,100)}%` : "N/A";
      }
      updateLeaderHeartbeat();
      updateSlowDisplay();
      await saveStateToServer(simulationState);
    }
    setInterval(updateSlowMetrics, 30000);
    setInterval(updateTimeField, 1000);
  </script>
</body>
</html>
