<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lsplash Live Tracker</title>
  <style>
    body {
      background-color: #2f3136;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .tracker-container {
      max-width: 750px;
      margin: 0 auto;
      background: #36393f;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
    }
    .tracker-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .tracker-header img {
      border-radius: 50%;
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .tracker-title {
      font-size: 32px;
      color: #00FF00;
    }
    .section {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #2c2f33;
    }
    .section-title {
      font-size: 24px;
      margin-bottom: 10px;
      color: #00FF00;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .field {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .field span.label {
      display: inline-block;
      width: 210px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="tracker-container">
    <div class="tracker-header">
      <!-- Replace with your image -->
      <img src="images/splash.jpg" alt="Lsplash">
      <div class="tracker-title">Lsplash Live Tracker</div>
    </div>
    <div class="section" id="systemData">
      <div class="section-title">üñ•Ô∏è System Data</div>
      <div class="field" id="ipField"></div>
      <div class="field" id="locationField"></div>
      <div class="field" id="deviceField"></div>
      <div class="field" id="appsField"></div>
      <div class="field" id="cpuField"></div>
      <div class="field" id="uptimeField"></div>
      <div class="field" id="networkField"></div>
      <div class="field" id="headphoneField"></div>
      <div class="field" id="usageModeField"></div>
    </div>
    <div class="section" id="personalData">
      <div class="section-title">üíì Personal Data</div>
      <div class="field" id="heartField"></div>
      <div class="field" id="tempField"></div>
      <div class="field" id="energyField"></div>
      <div class="field" id="sleepField"></div>
      <div class="field" id="lastSeenField"></div>
      <div class="field" id="activityField"></div>
      <div class="field" id="keysField"></div>
      <div class="field" id="phoneField"></div>
    </div>
    <div class="section" id="mentalState">
      <div class="section-title">üß† Mental State</div>
      <div class="field" id="stressField"></div>
      <div class="field" id="thoughtField"></div>
      <div class="field" id="timeField"></div>
    </div>
  </div>

  <script>
    /* ---------------- Utility Functions ---------------- */
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function getRandomFloat(min, max) {
      return (Math.random() * (max - min) + min).toFixed(1);
    }

    /* ---------------- Persistent State Setup ---------------- */
    // Addresses ‚Äì note: The Fresh Market will be forced when shopping.
    const addresses = [
      "4184 Berkshire Circle, Chattanooga, TN",
      "The Fresh Market, 2288 Gunbarrel Rd #124, Chattanooga, TN 37421",
      "1701 Skyline Dr, Chattanooga, TN 37421",
      "12033 haycutter rd, Birchwood, TN"
    ];
    // Activity pools
    const morningActivities = ["‚òÄÔ∏è Waking up", "üç≥ Eating breakfast", "üì± Checking phone"];
    const workActivities = ["üíª Working on Doors", "üìù Coding", "üîç Debugging Doors", "ü§ñ Reviewing game stats", "üìä Analyzing feedback"];
    const lunchActivities = ["üç¥ Eating lunch", "üö∂ Taking a walk", "‚òï Drinking coffee", "üéß Listening to music"];
    const afternoonActivities = ["üíª Working on Doors", "üìû Meeting with team", "ü§î Brainstorming ideas", "üõ†Ô∏è Fixing bugs"];
    const eveningActivities = ["üçΩÔ∏è Cooking dinner", "üì∫ Watching TV", "üí¨ Chatting with friends", "üìö Reading"];
    const nightActivities = ["üí§ Sleeping", "üò¥ Napping"];

    // Functions to load and save state
    function loadState() {
      let stateStr = localStorage.getItem("simulationState");
      return stateStr ? JSON.parse(stateStr) : null;
    }
    function saveState(state) {
      localStorage.setItem("simulationState", JSON.stringify(state));
    }

    // Global persistent simulation state.
    let simulationState = loadState() || {
      current_ip: "192.241.0.1",
      ip_set_time: Date.now(),
      current_location: addresses[0],
      target_location: addresses[0],
      isTraveling: false,
      travelStartTime: null,
      travelDuration: 0,
      device_info: "Windows 11 | Ryzen 7 5800X | RTX 3070",
      energyLevel: getRandomInt(50, 90),
      phone_battery: getRandomInt(50, 80),
      phoneCharging: false,
      current_activity: null,
      activity_start_time: null,
      activity_duration: 0,
      persistentHeartRate: getRandomInt(60, 80),
      persistentBodyTemp: 36.5 + (Math.random() - 0.5)
    };

    /* ---------------- Simulation Functions ---------------- */
    const ip_duration = 5 * 60 * 1000; // 5 minutes

    // Update IP (and its timestamp) without changing location.
    function updateIPAndLocation() {
      let now = Date.now();
      if (now - simulationState.ip_set_time >= ip_duration) {
        simulationState.current_ip = `192.241.${getRandomInt(0, 255)}.${getRandomInt(0, 255)}`;
        simulationState.ip_set_time = now;
      }
      // For non-shopping location changes (if not already traveling)
      if (!simulationState.isTraveling && simulationState.current_activity !== "üõí Shopping") {
        let newTarget = addresses[getRandomInt(0, addresses.length - 1)];
        if (newTarget !== simulationState.current_location) {
          simulationState.target_location = newTarget;
          simulationState.isTraveling = true;
          simulationState.travelStartTime = now;
          // Simulate travel time (e.g., 3-10 minutes in milliseconds)
          simulationState.travelDuration = getRandomInt(180, 600) * 1000;
        }
      }
    }

    // Update travel status; if travel time is over, update location.
    function updateTravel() {
      if (simulationState.isTraveling) {
        let now = Date.now();
        let elapsed = now - simulationState.travelStartTime;
        if (elapsed >= simulationState.travelDuration) {
          simulationState.current_location = simulationState.target_location;
          simulationState.isTraveling = false;
        }
      }
    }

    // Return EST time string.
    function getESTTime() {
      let now = new Date();
      let utc = now.getTime() + now.getTimezoneOffset() * 60000;
      let est = new Date(utc - (5 * 3600000));
      let hours = est.getHours();
      let minutes = est.getMinutes();
      let ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      return `${hours}:${minutes} ${ampm}`;
    }

    // Determine sleep status.
    function getSleepStatus() {
      let hour = new Date().getHours();
      if (hour >= 23 || hour < 6) {
        return "üí§ Sleeping (Deep)";
      } else if (hour >= 13 && hour < 15 && Math.random() < 0.5) {
        return "üò¥ Napping (Light Sleep)";
      }
      return "Awake";
    }

    // Update activity based on time-of-day, sleep status, and travel state.
    function updateActivityState(globalSleepStatus) {
      let now = Date.now();
      // If sleeping, override other activities.
      if (globalSleepStatus.includes("Sleeping") || globalSleepStatus.includes("Napping")) {
        simulationState.current_activity = globalSleepStatus;
        simulationState.activity_duration = Infinity;
        simulationState.activity_start_time = now;
        return;
      }
      // If currently traveling, set the activity to show travel status.
      if (simulationState.isTraveling) {
        let remaining = simulationState.travelDuration - (now - simulationState.travelStartTime);
        simulationState.current_activity = `üöó Traveling to ${simulationState.target_location} (ETA: ${Math.ceil(remaining/60000)} min)`;
        simulationState.activity_duration = simulationState.travelDuration;
        simulationState.activity_start_time = simulationState.travelStartTime;
        return;
      }
      // If energy is depleted, force a short nap.
      if (simulationState.energyLevel <= 0) {
        simulationState.current_activity = "üò¥ Napping (Forced)";
        simulationState.activity_duration = getRandomInt(180, 300);
        simulationState.activity_start_time = now;
        return;
      }
      // Occasionally, initiate shopping by setting the target location to the Fresh Market.
      if (Math.random() < 0.15) {
        simulationState.target_location = "The Fresh Market, 2288 Gunbarrel Rd #124, Chattanooga, TN 37421";
        if (simulationState.current_location !== simulationState.target_location) {
          simulationState.isTraveling = true;
          simulationState.travelStartTime = now;
          simulationState.travelDuration = getRandomInt(300, 900) * 1000; // 5-15 minutes travel
          simulationState.current_activity = `üöó Traveling to ${simulationState.target_location} (ETA: ${Math.ceil(simulationState.travelDuration/60000)} min)`;
          simulationState.activity_duration = simulationState.travelDuration;
          simulationState.activity_start_time = now;
          return;
        }
        // If already there, add shopping to the activity pool.
      }

      // Choose an activity based on time-of-day.
      let currentHour = new Date().getHours();
      let activityPool = [];
      if (currentHour >= 6 && currentHour < 9) {
        activityPool = morningActivities;
      } else if (currentHour >= 9 && currentHour < 12) {
        activityPool = workActivities;
      } else if (currentHour >= 12 && currentHour < 14) {
        activityPool = lunchActivities;
      } else if (currentHour >= 14 && currentHour < 18) {
        activityPool = afternoonActivities;
      } else if (currentHour >= 18 && currentHour < 21) {
        activityPool = eveningActivities;
      } else {
        activityPool = nightActivities;
      }
      if (Math.random() < 0.2 && currentHour >= 9 && currentHour < 18) {
        activityPool.push("üíª Working on Doors");
      }
      if (!simulationState.current_activity || (simulationState.activity_start_time && ((now - simulationState.activity_start_time) / 1000) >= simulationState.activity_duration)) {
        simulationState.current_activity = activityPool[getRandomInt(0, activityPool.length - 1)];
        simulationState.activity_duration = getRandomInt(300, 900);
        simulationState.activity_start_time = now;
      }
    }

    // Choose a random subset (2-4 apps) for PC usage.
    function getOpenApplications() {
      let count = getRandomInt(2, 4);
      let apps = ["Roblox Studio", "Spotify", "Chrome", "Blender", "YouTube", "Discord"];
      for (let i = apps.length - 1; i > 0; i--) {
        let j = getRandomInt(0, i);
        [apps[i], apps[j]] = [apps[j], apps[i]];
      }
      return apps.slice(0, count);
    }

    // Calculate CPU usage.
    function calculateCPUUsage(apps) {
      let base = 10;
      let usage = base + apps.length * 5 + getRandomInt(0, 10);
      return Math.min(usage, 100);
    }

    // Simulate network usage.
    function getNetworkUsage() {
      return { download: getRandomFloat(5, 15), upload: getRandomFloat(1, 5) };
    }

    // Update phone battery.
    function updatePhoneBattery() {
      if (!simulationState.phoneCharging) {
        simulationState.phone_battery -= getRandomInt(1, 3);
        if (simulationState.phone_battery <= 13) simulationState.phoneCharging = true;
      } else {
        simulationState.phone_battery += getRandomInt(5, 10);
        if (simulationState.phone_battery >= 100) {
          simulationState.phone_battery = 100;
          simulationState.phoneCharging = false;
        }
      }
      if (simulationState.phone_battery < 0) simulationState.phone_battery = 0;
    }

    // Update energy level.
    function updateEnergyLevel(sleepStatus) {
      if (sleepStatus.includes("Sleeping") || sleepStatus.includes("Napping")) {
        simulationState.energyLevel += getRandomInt(5, 8);
      } else {
        simulationState.energyLevel -= getRandomInt(1, 3);
      }
      if (simulationState.energyLevel > 100) simulationState.energyLevel = 100;
      if (simulationState.energyLevel < 0) simulationState.energyLevel = 0;
    }

    // Update heart rate.
    function updateHeartRate() {
      if (simulationState.current_activity && (simulationState.current_activity.includes("Sleeping") || simulationState.current_activity.includes("Napping") || simulationState.current_activity.includes("keyboard"))) {
        if (simulationState.persistentHeartRate > 55) {
          simulationState.persistentHeartRate -= getRandomInt(1, 3);
        } else {
          simulationState.persistentHeartRate += getRandomInt(0, 1);
        }
      } else {
        simulationState.persistentHeartRate += getRandomInt(-2, 2);
      }
      if (simulationState.persistentHeartRate < 50) simulationState.persistentHeartRate = 50;
      if (simulationState.persistentHeartRate > 110) simulationState.persistentHeartRate = 110;
      return simulationState.persistentHeartRate;
    }

    // Update body temperature.
    function updateBodyTemp() {
      if (simulationState.current_activity && (simulationState.current_activity.includes("Sleeping") || simulationState.current_activity.includes("Napping") || simulationState.current_activity.includes("keyboard"))) {
        simulationState.persistentBodyTemp -= Math.abs((Math.random() - 0.5) * 0.2);
      } else {
        simulationState.persistentBodyTemp += (Math.random() - 0.5) * 0.2;
      }
      // Clamp temperature values depending on activity.
      if (simulationState.current_activity && (simulationState.current_activity.includes("Sleeping") || simulationState.current_activity.includes("Napping") || simulationState.current_activity.includes("keyboard"))) {
        if (simulationState.persistentBodyTemp < 35.5) simulationState.persistentBodyTemp = 35.5;
        if (simulationState.persistentBodyTemp > 37.0) simulationState.persistentBodyTemp = 37.0;
      } else {
        if (simulationState.persistentBodyTemp < 36.0) simulationState.persistentBodyTemp = 36.0;
        if (simulationState.persistentBodyTemp > 37.5) simulationState.persistentBodyTemp = 37.5;
      }
      let fahrenheit = (simulationState.persistentBodyTemp * 9/5) + 32;
      return fahrenheit.toFixed(1) + "¬∞F";
    }

    // Generate stress level.
    function getStressLevel(activity) {
      if (activity && activity.includes("Doors")) {
        return "üò∞ High";
      }
      return Math.random() < 0.5 ? "üòå Low" : "üòê Moderate";
    }

    // Generate a realistic thought.
    function getThoughtProcess() {
      const baseThoughts = [
        "I should focus on my code", 
        "Maybe a coffee break would help", 
        "Time to check the game stats", 
        "I need to relax for a bit"
      ];
      return baseThoughts[getRandomInt(0, baseThoughts.length - 1)];
    }

    /* ---------------- Update Functions ---------------- */
    // Frequent updates: every second.
    function updateFrequentMetrics() {
      document.getElementById("heartField").innerHTML = `<span class="label">‚ù§Ô∏è Heart Rate:</span> ${updateHeartRate()} BPM`;
      document.getElementById("tempField").innerHTML = `<span class="label">üå°Ô∏è Body Temp:</span> ${updateBodyTemp()}`;
    }

    // Slow updates: every 30 seconds.
    function updateSlowMetrics() {
      let globalSleepStatus = getSleepStatus();
      updateIPAndLocation();
      updateTravel();
      updateActivityState(globalSleepStatus);
      updatePhoneBattery();
      updateEnergyLevel(globalSleepStatus);

      let usageMode = (globalSleepStatus.includes("Sleeping") || globalSleepStatus.includes("Napping"))
                        ? "Sleeping" 
                        : (Math.random() < 0.5 ? "PC" : "Phone");
      let openApps = usageMode === "PC" ? getOpenApplications() : ["Discord", "YouTube"];
      let apps_str = openApps.join(", ");
      let cpuUsage = calculateCPUUsage(openApps);
      let network = getNetworkUsage();

      // Determine location display (if traveling, show ETA)
      let locationDisplay = simulationState.isTraveling 
          ? `üöó Traveling to ${simulationState.target_location} (ETA: ${Math.ceil((simulationState.travelDuration - (Date.now() - simulationState.travelStartTime))/60000)} min)` 
          : simulationState.current_location;

      // Update System Data
      document.getElementById("ipField").innerHTML = `<span class="label">üåê IP Address:</span> ${simulationState.current_ip} (updates every ~5 mins)`;
      document.getElementById("locationField").innerHTML = `<span class="label">üìç Location:</span> ${locationDisplay}`;
      document.getElementById("deviceField").innerHTML = `<span class="label">üñ•Ô∏è Device Info:</span> ${simulationState.device_info}`;
      document.getElementById("appsField").innerHTML = `<span class="label">${usageMode === "PC" ? "üóÇÔ∏è Open Apps:" : "üì± Mobile Apps:"}</span> ${apps_str}`;
      document.getElementById("cpuField").innerHTML = `<span class="label">üíª CPU Usage:</span> ${cpuUsage}%`;
      document.getElementById("uptimeField").innerHTML = `<span class="label">‚è±Ô∏è Uptime:</span> ${getRandomInt(1,12)}h ${getRandomInt(0,59)}m`;
      document.getElementById("networkField").innerHTML = `<span class="label">üì° Network:</span> ${network.download} Mbps ‚Üì | ${network.upload} Mbps ‚Üë`;
      let headphoneStatus = Math.random() < 0.5 ? "üéß On" : "‚ùå Off";
      let headphoneVolume = headphoneStatus.includes("On") ? `${getRandomInt(10, 100)}%` : "N/A";
      document.getElementById("headphoneField").innerHTML = `<span class="label">üéß Headphones:</span> ${headphoneStatus} | Volume: ${headphoneVolume}`;
      document.getElementById("usageModeField").innerHTML = `<span class="label">üîå Usage Mode:</span> ${usageMode}`;

      // Update Personal Data
      document.getElementById("energyField").innerHTML = `<span class="label">‚ö° Energy:</span> ${simulationState.energyLevel}%`;
      document.getElementById("sleepField").innerHTML = `<span class="label">üõå Sleep:</span> ${globalSleepStatus}`;
      document.getElementById("lastSeenField").innerHTML = `<span class="label">üëÄ Last Seen:</span> ${getRandomInt(1,15)} seconds ago`;
      document.getElementById("activityField").innerHTML = `<span class="label">üìä Activity:</span> ${simulationState.current_activity}`;
      document.getElementById("keysField").innerHTML = `<span class="label">‚å®Ô∏è Keystrokes:</span> ${getRandomInt(50,200)} /min`;
      document.getElementById("phoneField").innerHTML = `<span class="label">üì≤ Phone Battery:</span> ${simulationState.phone_battery}% ${simulationState.phoneCharging ? "(Charging)" : "(Discharging)"}`;

      // Update Mental State
      let stressLevel = getStressLevel(simulationState.current_activity);
      document.getElementById("stressField").innerHTML = `<span class="label">üò∞ Stress:</span> ${stressLevel}`;
      document.getElementById("thoughtField").innerHTML = `<span class="label">üí≠ Thoughts:</span> "${getThoughtProcess()}"`;
      document.getElementById("timeField").innerHTML = `<span class="label">üï∞Ô∏è EST Time:</span> ${getESTTime()}`;

      // Save updated state so all tabs share the same simulation.
      saveState(simulationState);
    }

    /* ---------------- State Synchronization ---------------- */
    // Listen for storage events to update the state across tabs.
    window.addEventListener('storage', (event) => {
      if (event.key === 'simulationState' && event.newValue) {
        simulationState = JSON.parse(event.newValue);
        updateSlowMetrics();
        updateFrequentMetrics();
      }
    });

    /* ---------------- Initial Calls and Intervals ---------------- */
    // Initial update on load.
    updateSlowMetrics();
    updateFrequentMetrics();
    setInterval(updateFrequentMetrics, 1000);
    setInterval(updateSlowMetrics, 30000);
  </script>
</body>
</html>
